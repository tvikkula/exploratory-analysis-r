---
title: "Exploratory analysis of what chemical properties make white wine good"
author: "Tommi Vikkula"
output: html_document
---
## Initialization

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# load the ggplot graphics package and the others
library(ggplot2)
library(GGally)
library(scales)
library(memisc)
library(gridExtra)
library(dplyr)
```

Loading the dataset and looking at its structure and variables
```{r echo=FALSE}
setwd('~/Dev/python/datascience/exploratoryR/project/')
wines <- read.csv('wineQualityWhites.csv', sep=',')
summary(wines)
str(wines)

```

#Exploratory analysis of the data

##Analysis of variable distributions

###Distribution of wine quality
```{r echo=FALSE}
ggplot(aes(x = quality), data = wines) +
  geom_histogram(binwidth = 1, fill = 'purple', color = 'black')
```

The qualities of wine seem to be distributed around the median of 6. The tail tail is slightly higher on the lower-quality side, with 5-quality wines being by far the 2nd most numerous quality after 6. It also seems that no wines were given either a 10, or 0-2. Additionally, only 5 wines were of quality 9. As vast majority of wines seem to have a quality of either 5 or 6.

Therefore since there are so few wines qualities under 4 or over 8, we will subset the dataset to exclude them.
```{r echo=FALSE}
wines_subset <- subset(wines, quality > 3 & quality < 9)
```

In order to determine independent variable distributions and discover possible outliers, lets also plot histograms of the independent variables.

###Distribution of Fixed acidity
```{r echo=FALSE}
ggplot(aes(x = fixed.acidity), data = wines_subset) +
  geom_histogram(binwidth = 0.1, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(4,12), breaks = seq(4, 12, 0.5))
```

Fixed acidity seems very normally distributed with values falling between around 4.4 and 9.6. Lets look at the quantiles in the feature.

```{r echo=FALSE}
summary(wines_subset$fixed.acidity)
```

Despite the data being quite normally distributed, there seems to be at least a few high outliers.

Looking at the distribution, lets cut the outliers by using only values less than 10. Values higher than that seem to be outliers.

```{r echo=FALSE}
wines_subset <- subset(wines_subset, fixed.acidity < 10)
```


###Distribution of Volatile acidity
```{r echo=FALSE}
ggplot(aes(x = volatile.acidity), data = wines_subset) +
  geom_histogram(binwidth = 0.01, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(0.05,1.1), breaks = seq(0.05, 1.1, 0.05))
```

Volatile acidity seems almost normally distributed, except it has a long tail on the incresing side of the values. Lets look at the quantiles of volatile acidity.

```{r echo=FALSE}
summary(wines_subset$volatile.acidity)
```

The final 4th quantile of volatile acidity seems to be inside the long tail between 0.32 and 1.1. The values seem to have some very high outliers at the end of the long tail.

Lets cut out values over 0.70.

```{r}
wines_subset <- subset(wines_subset, volatile.acidity < 0.70)
```


###Distribution of Citric acid
```{r echo=FALSE}
ggplot(aes(x = citric.acid), data = wines_subset) +
  geom_histogram(binwidth = 0.01, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(0,1.25), breaks = seq(0, 1.25, 0.1))
```

Citric acid seems to also be quite normally distributed (albeit with a long tail) with a few peculiar exceptions that can distort the interpretation of the data. Citric acid has huge spikes in frequencies at 0.5 and 0.75 it seems. Especially the one at 0.5 is curious as it almost rivals the most frequent citric.acid levels at around 0.3. This may be due to the fact that the distillers of more acidic wine may opt for this exact amount of citric acid.


```{r echo=FALSE}
summary(wines_subset$citric.acid)
```

The quantiles seem quite normally distributed with the exception of a few outliers in the final quantile. These spikes are only really noticeable in the visualization.

To exclude outliers, lets include only values less than or equal to 0.75 (to make sure the high citric.acid spike gets included).

```{r}
wines_subset <- subset(wines_subset, citric.acid <= 0.75)
```


###Distribution of Residual sugar
```{r echo=FALSE}
ggplot(aes(x = residual.sugar), data = wines_subset) +
  geom_histogram(binwidth = 0.2, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(0,25), breaks = seq(0, 25, 1))
```

Residual sugar seems very long tailed, with most wine not having much sugar.

```{r}
summary(wines_subset$residual.sugar)
```

As seen in the visualization, mean is significantly higher and final quantiles are quite long after the first quantile, indicating the long tail also seen in the visualization. There are also a few very large outliers. 

To cut them out, lets include only values less than 20.
```{r}
wines_subset <- subset(wines_subset, residual.sugar < 20)
```

### Distribution of Chlorides
```{r echo=FALSE}
ggplot(aes(x = chlorides), data = wines_subset) +
  geom_histogram(binwidth = 0.001, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(0,0.25), breaks = seq(0, 0.25, 0.05))
```

Chlorides seem very normally distributed with a few outliers at the end of a long tail. Overall the variance of the values seems quite low.

```{r echo=FALSE}
summary(wines_subset$chlorides)
```

The quantiles seem very even, although there are a few large values.

Lets cut the large values by only including values under 0.10.

```{r echo=FALSE}
wines_subset <- subset(wines_subset, chlorides < 0.10)
```


###Distribution of Free sulfur dioxide
```{r echo=FALSE}
ggplot(aes(x = free.sulfur.dioxide), data = wines_subset) +
  geom_histogram(binwidth = 1, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(0, 150), breaks = seq(0, 150, 25))
```

Free sulfur dioxide is quite normally distributed except the right side of the curve seems slightly less steep. There are a few outliers.

```{r echo=FALSE}
summary(wines_subset$free.sulfur.dioxide)
```

The quantiles explain the same story as the visualization. The third quantile is 46 which is slightly longer than the 2nd quantile and the maximum value is 138.50 indicating some outliers.

Lets cut those out by only including values under 80.

```{r echo=FALSE}
wines_subset <- subset(wines_subset, free.sulfur.dioxide < 80)
```


###Distribution of Total sulfur dioxide
```{r echo=FALSE}
ggplot(aes(x = total.sulfur.dioxide), data = wines_subset) +
  geom_histogram(binwidth = 2, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(0, 280), breaks = seq(0, 280, 10))
```

Total sulfur dioxide seems also quite normally distributed with a slightly less steep curve on the right side. The variance in values seems quite high since the tails are not that steep.

```{r echo=FALSE}
summary(wines_subset$total.sulfur.dioxide)
```

There also seems to be a few high values indicated by the maximum value.

Lets cut them out by only including values under 270.

```{r echo=FALSE}
wines_subset <- subset(wines_subset, total.sulfur.dioxide < 270)
```

###Distribution of Density
```{r echo=FALSE}
ggplot(aes(x = density), data = wines_subset) +
  geom_histogram(binwidth = 0.0005, fill = 'purple', color = 'black') +
  scale_x_continuous(limits = c(0.985, 1.01), breaks = seq(0.985, 1.01, 0.005))
```

Density values seems to have very little variance, almost all the values fall between 0.990 and 1.000.

```{r echo=FALSE}
summary(wines_subset$density)
```

The 4th quantile seems to have a small tail but overall there seems to be no real outliers. Therefore there is no real need to subset density.

###Distribution of Ph
```{r echo=FALSE}
ggplot(aes(x = pH), data = wines_subset) +
  geom_histogram(binwidth = 0.05, fill = 'purple', color = 'black') +
    scale_x_continuous(limits = c(2.5, 4), breaks = seq(2.5, 4, 0.5))
```

Similar to density, the pH-values have little variation with most of the values falling between 3 and 3.5. The distribution looks to be very normal.

```{r echo=FALSE}
summary(wines_subset$pH)
```

The quantiles seem to support what the visualization shows, there seems to not be any real outliers in the values. Therefore the subsetting of pH is unnecessary.

### Distribution of Sulphates
```{r echo=FALSE}
ggplot(aes(x = sulphates), data = wines_subset) +
  geom_histogram(binwidth = 0.01, fill = 'purple', color = 'black') +
      scale_x_continuous(limits = c(0, 1.5), breaks = seq(0, 1.5, 0.1))
```

Sulphates seem to be a bit long-tailed on the right side and the values have several peaks between 0.4 and 0.6.

```{r echo=FALSE}
summary(wines_subset$sulphates)
```
The quantiles also indicate the existance of a less steep curve on the 3rd and 4th quantiles. And there are a few outliers on the end of the 4th quantile. The quantiles do not explain the peaks in the values which can only really be seen by visualizing the distribution.

Lets cut the outliers by only accepting values under 0.9.

```{r echo=FALSE}
wines_subset <- subset(wines_subset, sulphates < 0.9)
```


Alcohol
```{r echo=FALSE}
ggplot(aes(x = alcohol), data = wines_subset) +
  geom_histogram(binwidth = 0.1, fill = 'purple', color = 'black') +
      scale_x_continuous(limits = c(8, 15), breaks = seq(8, 15, 1))

```

Alcohol seems to have most of the values at the low end of the curve, and the higher alcohol amounts being less frequent. The lowering curve is quite linear with little outliers. The variance also seems to be quite high.

```{r echo=FALSE}
summary(wines_subset$alcohol)
```

## Exploring bipartite relationships between independent variables and wine quality

After running ggpairs to view the relationships of features, the plots and the correlation values seem to indicate a poor correlation between the independant variables and the wine quality. This seems quite understandable as it is difficult to imagine there being linear relationships between wine quality and for example salt-, sugar-, and alcohol-content of the wine or acidity.

GGpairs output is not shown here as it looks poor on knit html. To get a clearer view of the variables relationships with wine quality, I will plot them as boxplots. The boxplots are a good way to interpret variation of values of the independent variables against our dependant variable, which can be interpreted as a categorical variable.

In the boxplots we visualize some promising possible independent variables vs wine quality.

Looking at the ggpairs-output, fixed.acidity, volatile.acidity, residual.sugar, total.sulfur.dioxide, citric.acid, density and alcohol seemed like the most promising dependant variables to affect wine quality.

In order to get a better estimate on the variance in the independent variable values, lets create boxplots of the relationships between the independent variables and wine quality.

###Box plots of wine quality and promising independent variables (fixed.acidity, volatile.acidity, residual.sugar, total.sulfur.dioxide, citric.acid, density, alcohol)
```{r echo=FALSE,message=FALSE,warning=FALSE}
# Set quality to a factor
wines_subset$quality_factor <- factor(wines_subset$quality,
                        levels = c("1","2","3","4","5","6","7","8","9","10"))
```

####Fixed acidity vs quality
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = fixed.acidity),
      data = wines_subset) +
  geom_boxplot()
```

Looking at the relationships in the boxplot, there still seems to be some outliers in the fixed acidity-values. Looking at the means and the middle quantiles, it seems that the correlation with wine quality seems quite low, non-linear and even non-modal. At qualities 4-7 the fixed.acidity seems to reduce but at quality of 8 the fixed.acidity rises again.

Lets zoom a bit closer to see the middle quantiles better
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = fixed.acidity),
      data = wines_subset) +
  geom_boxplot() +
  coord_cartesian(ylim = c(6,8))
```

In the zoomed boxplot the correlations seem to indicate the same conclusions as in the non-zoomed one.

Due to the correlation looking obviously nonlinear and non-modal, the correlation tests will likely provide an incorrect metric on the correlation of the variables.

```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), wines_subset$fixed.acidity, method = 'spearman')
```

The correlation looks very low but it might be higher in actuality due to the non-modal nature of the relationship.

####Volatile acidity vs quality
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = volatile.acidity),
      data = wines_subset) +
  geom_boxplot()
```

In volatile acidity the variance of values between different qualities seems higher. The correlation seems non-modal and non-linear here as well.

```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = volatile.acidity),
      data = wines_subset) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0.18, 0.45))
```
In the zoomed plot, the volatile acidity seems to drop at first between qualities 4-6 and then stay at somewhat similar levels.

Lets run a Spearman correlation test to quantify this correlation. Spearman is used as the correlation seems to be nonlinear.
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), wines_subset$volatile.acidity, method = 'spearman')
```

The variables seem to have slight negative correlation as the boxplots suggest.

####Residual sugar vs quality
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = residual.sugar),
      data = wines_subset) +
  geom_boxplot()
```

Residual sugar seems to have fewer outliers in the boxplot than the previous variables. Also the variance between qualities seems nonexistant in the first quantile of the data and then the variance will rise significantly in the next quantiles. This seems to follow the significant long-tailed pattern seen in the distribution of residual.sugar. 

Around the mean the quality and residual.sugar correlation seems to follow a strong bimodal pattern. Low quality wines seem to not be as sweet as the average wines and the sweetness starts to drop again once we move to higher quality wines (although 8-quality wines seem slightly sweet than the 7-quality ones).

Besides the non-modal correlation pattern, there seems to be significant variation between residual.sugar values and quality. But due to the non-modal nature of the relationship, a correlation test may give slightly misguided results and hence I will trust the visualization on the nature of the relationship.

Lets do the correlation test anyway (using Spearman again):
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), wines_subset$residual.sugar, method = 'spearman')
```

The correlation value seems really low, which I feel does not tell the whole story on the relationship between residual.sugar and quality.

####Total sulfur dioxide vs quality

```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = total.sulfur.dioxide),
      data = wines_subset) +
  geom_boxplot()
```

There seem to be a few rather large outliers here and once again some nonlinear and non-modal correlation can be seen in the data. It seems that the total sulfur dioxide starts lower at lower quality wines, then rising a bit at average quality wiens and then lowering again as the quality increases and then reaching its minimum at quality 7 and then remains at similar values at quality 8 as well.

Lets look at the Spearman correlation:
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), wines_subset$total.sulfur.dioxide, method = 'spearman')
```

Despite the nonmodal relationship of the variables, the correlation test shows some slight negative correlation. If we ignore the rising trend between qualities 4 and 5, the relationship does seem quite clearly like a modal, nonlinear, negative correlation.

####Citric acid vs quality

```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = citric.acid),
      data = wines_subset) +
  geom_boxplot()
```

Looking at the plot, there seem to be quite of few values outside the middle quantiles. The middle quantiles though seem to have quite low variance, especially at higher qualities. The relationship with quality also seems quite modal.

```{r}
ggplot(aes(x = quality_factor, y = citric.acid),
      data = wines_subset) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0.2,0.4))
```

Zooming into the data, we can definately see some nonlinear positive correlation here.

Lets look the correlation with a Spearman test:
```{r}
cor.test(as.numeric(wines_subset$quality), wines_subset$citric.acid, method = 'spearman')
```

The test seems to indicate that the positive correlation is very low. This could, in part, be explained by the outliers in the dataset and the high variance of citric.acid the outer quantiles.

####Density vs quality

```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = density),
      data = wines_subset) +
  geom_boxplot()
```

The relationship, once again, seems non-modal, but there is definite variation between different wine qualities causing us to believe that there is some sort of a relationship between density and quality.

Lets try a Spearman test:
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), wines_subset$density, method = 'spearman')
```

Despite the non-modality, there seems to be some definite correlation between the variables according to the Spearman test.

####Alcohol vs quality
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = alcohol),
      data = wines_subset) +
  geom_boxplot()
```

Once again, there seems to be a clear non-modal relationship between the variables. Interestingly enough, the pattern looks very similar to other independent variables. The correlation seems positive here though.

Lets try a Spearman test:
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), wines_subset$alcohol, method = 'spearman')
```

Despite the non-modality, the positive correlation seems to clearly be there.

###Trying out curious relationships between independet variables

Next, lets try to find interesting relationships between some of the independant variables. Some of the relationships-of-interest might include alcohol vs density, residual.sugar vs alcohol, citric.acid vs volatile.acidity, citric.acid vs residual.sugar.

####Alcohol vs density

```{r echo=FALSE}
ggplot(aes(x = density, y = alcohol), data = wines_subset) +
  geom_point()
```

There seems to be some negative correlation between alcohol and density. As the density-level rises, the amount of alcohol reduces.

Lets see if any patterns emerge if we color the plot by quality.

```{r echo=FALSE}
ggplot(aes(x = density, y = alcohol, color = quality_factor),
    data = wines_subset) +
  geom_point()
```

There seems to be a slight pattern that high quality wines have both high amount of alcohol and low density. This complies with the discoveries when looking at the boxplots and correlations of alcohol vs quality and density vs quality.

####Redidual sugar vs alcohol

```{r echo=FALSE}
ggplot(aes(x = residual.sugar, y = alcohol), data = wines_subset) +
  geom_point()
```

It is difficult to see any patterns here, so lets add some alpha to the plot:
```{r echo=FALSE}
ggplot(aes(x = residual.sugar, y = alcohol), data = wines_subset) +
  geom_point(alpha=1/10)
```

It is difficult to find any relationships in this chart. Most of the values seem to be on the left side of the chart, which is caused by the fact that a significant amount of wines had a low sugar amount (as seen in the long-tailed pattern of the residual.sugar histogram). Additionally, it seems that sweeter wines have a lower alcohol amount, which is curious.

Lets see if any patterns emerge when coloring the scatterplot with quality
```{r echo=FALSE}
ggplot(aes(x = residual.sugar, y = alcohol, color = quality_factor),
    data = wines_subset) +
  geom_point()
```

When looking at the plot, there seems to be a slight pattern of qualities being higher at the high alcohol-low sugar end of the plot. This, however, might not indicate a meaningful relationship here, instead the combination of positive correlation of alcohol vs quality and the dataset having mostly low-sugar wines could provide an explanation to this phenomenon.

Lets look at the ratio of sugar and alcohol vs quality in a boxplot
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = (alcohol/residual.sugar)),
    data = wines_subset) +
  geom_boxplot()
```

There does seem to be some variance between the ratio-values at different qualities. The relationship is clearly nonlinear and also non-monotonic.

Lets test the correlation using Spearman
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), (wines_subset$alcohol / wines_subset$residual.sugar), method = 'spearman')
```

There seems to be some small positive correlation in the model. The correlation is unreliable, however, as the relationship is clearly non-monotonic therefore breaking the assumptions of a Spearman test.

####Citric acid vs volatile acidity

```{r echo=FALSE}
ggplot(aes(x = citric.acid, y = volatile.acidity), data = wines_subset) +
  geom_point()
```

According to the plot, there doesn't really seem to be any meaningful relationships between the variables.

Lets see if anything interesting comes up when coloring the plot with quality:
```{r}
ggplot(aes(x = citric.acid, y = volatile.acidity, color = quality_factor),
    data = wines_subset) +
  geom_point()
```

Now this might be interesting. In the middle of the cluster, there seems to be a high concentration of higher quality wines. Could there be a relationship here?

Lets see if there is a correlation between the ratio of citric.acidity and volatile.acidity vs quality
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = (citric.acid/volatile.acidity)),
    data = wines_subset) +
  geom_boxplot()
```

There seems to be slight positive correlation seen in the boxplot.

Lets do a Spearman test:
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), (wines_subset$citric.acid / wines_subset$volatile.acidity), method = 'spearman')
```

The test seems to comply with what the boxplot already told us - there does seem to be a small positive correlation.

####Citric acid vs residual sugar
```{r echo=FALSE}
ggplot(aes(x = citric.acid, y = residual.sugar), data = wines_subset) +
  geom_point()
```

This plot is also difficult to follow as the residual sugar values are so heavily skewed towards the low amounts of sugar.
No clear patterns emerge from the plot, except perhaps the fact that it seems that low citric.acid is only given to wines with low amounts of sugar. But that may also be due to the fact that the vast majority of wines are low in sugar.

Lets see if we can find anything by coloring the plot with quality.

```{r echo=FALSE}
ggplot(aes(x = citric.acid, y = residual.sugar, color = quality_factor),
    data = wines_subset) +
  geom_point()
```

The doesn't seem to be any visible patterns in the scatterplot.

Lets see if there is a correlation between the ratio of citric.acidity and volatile.acidity vs quality
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = (citric.acid/residual.sugar)),
    data = wines_subset) +
  geom_boxplot()
```

The patterns here seem very small. Lets zoom the plot a bit to see more.
```{r echo=FALSE}
ggplot(aes(x = quality_factor, y = (citric.acid/residual.sugar)),
    data = wines_subset) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0,0.25))
```

The correlation is tiny, but it seems to be there. The correlation looks nonlinear and non-monotonic, forming a kind of a wave-pattern in its relationship with quality.

Lets do a Spearman test:
```{r echo=FALSE}
cor.test(as.numeric(wines_subset$quality), (wines_subset$citric.acid / wines_subset$residual.sugar), method = 'spearman')
```

The seems to be some small positive correlation in the relationship of the ratio of citric acid and residual sugar vs quality. The correlation test is, however, unreliable as the relationship is clearly non-monotonic.




The boxplots further identify the problem: The features simply do not seem to be enough in explaining the quality of good wines. The most of the features have high variance in wines of good quality. And the features show very low, nonlinear correlation.

The features that seem to be correlating the most with wine quality seem to be:
- Alcohol, where alcohol start a bit higher at poor wines, decreasing until quality of 5 and afterwards increasing somewhat linearly.
- density, where better quality wines seem less dense.
- volatile.acidity, where better quality wines seem to be slightly less acidic. An outlier here are wines of quality 3, which do not follow a similar curve as the rest of the qualities, but this may very well occur because there are only 20 wines of quality 3.
- Also residual sugar showed some correlation with wine quality. The correlation, however, looks very non-monotonic, where the average wines seemed sweeter than poor and good wines.

Lets look at these three relationships further.

# Plots and summary

To get an idea of the features, lets first look at some descriptive statistics of alcohol, density, and volatile.acidity when they are group by wine quality. Quality of 9 and 3 wines are omitted as there are very few wines rated as such.
```{r echo=FALSE}
wines.stats_by_quality <- subset(wines, 
                                 wines$quality != 9 & wines$quality != 3) %>%
  group_by(quality) %>%
  summarize(mean_alcohol = mean(alcohol),
            median_alcohol = median(alcohol),
            variance_alcohol = var(alcohol),
            mean_density = mean(density),
            median_density = median(density),
            variance_density = var(density),
            mean_volatile.acidity = mean(volatile.acidity),
            median_volatile.acidity = median(volatile.acidity),
            variance_volatile.acidity = var(volatile.acidity),
            n = n()) %>%
  ungroup() %>%
  arrange(quality)

wines.stats_by_quality[,c('quality', 'mean_alcohol',
                          'median_alcohol', 'variance_alcohol')]
wines.stats_by_quality[,c('quality', 'mean_density',
                          'median_density', 'variance_density')]
wines.stats_by_quality[,c('quality', 'mean_volatile.acidity',
                          'median_volatile.acidity',
                          'variance_volatile.acidity')]
```

Looking at the mean and median of alcohol, they seem to follow a clear trend of increasing at a non-linear, slowing rate. The variance of alcohol at all quality levels is high though.

Looking at the mean and median of density, the differences at different quality levels seems very low. The variance is also very low.

Volatile.acidity mean and median seem to decrease at a slowing rate, converging at somewhere around 0.26. Similar to density, the variance seems quite low compared to other variables (although still not quite as low as in density).

Having this information, lets look at the boxplots of these 3 features closer. The boxplots are zoomed in a way that we can focus on the relationships around the mean and middle quantiles.

Alcohol vs quality
```{r echo=FALSE}
wines$quality <- factor(wines$quality,
                        levels =c("1","2","3","4","5","6","7","8","9","10"))
ggplot(aes(x = quality, y = alcohol),
       data = subset(wines, wines$quality != 9 & wines$quality != 3)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(9.1, 12.8)) +
  ylab('Alcohol (%)') +
  xlab('Wine Quality') +
  ggtitle('Alcohol of the Wine vs Quality')
```

Density vs quality
```{r echo=FALSE}
wines$quality <- factor(wines$quality,
                        levels =c("1","2","3","4","5","6","7","8","9","10"))
ggplot(aes(x = quality, y = density),
       data = subset(wines, wines$quality != 9 & wines$quality != 3)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0.9900,0.9975)) +
  ylab('Density (g/cm^3)') +
  xlab('Wine Quality') +
  ggtitle('Density of the Wine vs Quality')
```

Fixed.acidity vs quality
```{r echo=FALSE}
wines$quality <- factor(wines$quality,
                        levels =c("1","2","3","4","5","6","7","8","9","10"))
ggplot(aes(x = quality, y = volatile.acidity),
       data = subset(wines, wines$quality != 9 & wines$quality != 3)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0.18, 0.47)) +
  ylab('Volatile Acidity (acetic acid - g / dm^3)') +
  xlab('Wine Quality') +
  ggtitle('Amount of Acetic Acid vs Quality')
```

The boxplots seem to give further information to the correlation values discovered earlier. The relationship between density and alchol with wine quality displayed in the boxplots seemed to indicate slight nonlinear relationships. To relationships such as these, the pearson correlations calculated in the ggpairs-plots earlier may give some misleading correlation values that underestimate their actual correlation.

Lets try Spearman correlation instead
```{r echo=FALSE}
wines$quality <- as.numeric(wines$quality)
# Pearsons for comparison
cor.test(wines$quality, wines$alcohol, method = 'pearson')
cor.test(wines$quality, wines$density, method = 'pearson')
cor.test(wines$quality, wines$volatile.acidity, method = 'pearson')

# Now the Spearmans
cor.test(wines$quality, wines$alcohol, method = 'spearman')
cor.test(wines$quality, wines$density, method = 'spearman')
cor.test(wines$quality, wines$volatile.acidity, method = 'spearman')
```

The correlation between density and wine quality is now slightly higher. Alcohol and volatile.acidity changed very little which can be expected by looking at the boxplots. 

As seen in the boxplots, the relationships of quality and especially density seem to be slightly non-monotonic, therefore breaking the assumptions made by Spearman correlation on the data, causing us to suspect the Spearman correlations validity as well.

Lets try to build a linear model for wine quality using independent variables with the largest perceived correlation.
```{r}
wines$quality <- as.numeric(wines$quality)
m1 <- lm(I(quality) ~ I(volatile.acidity), data = wines)
m2 <- update(m1, ~ . + density)
m3 <- update(m2, ~ . + alcohol)
```

Since residual.sugar and sulphates showed some correlation, lets try adding it to the model as well:
```{r}
m4 <- update(m3, ~ . + residual.sugar)
m5 <- update(m4, ~ . + sulphates)
mtable(m1,m2,m3,m4,m5)
```

The linear model seems to explain the quality of a wine very poorly. It explains only 27.1% of the variance in wine quality.

Lets see what went wrong:
```{r}
summary(m5)
anova(m5)
```

The standard error seems high for density. It is quite a bit higher than the rest. The Pf(>t)-value seems quite low though, which causes me to believe with high confidence that all of the 4 independent variables do affect wine quality. The F-values and the p-tests of the independent variables all lead me to believe that the variables improve the regression model from the mere intercept-model.

Despite the fact that the independent variables used in the linear model obviously affect the model in a positive manner, the model created still seems ill suited to explain the wine quality, as seen from the low R-squared value.

# Reflection

The features provided seem ill suited to explain wine quality. This is quite understandable as the quality of wine should logically not have a linear positive correlation with features such as acidity, sweetness (sugar) or alcohol. There are numerous good wines that can be either sweet or not-so-sweet. This also explains the high variance of these features in wine qualities and the fact that some features could be quite similar in both low quality and high quality wines. It all comes down to the combination of different flavors and of course, personal preference.

The dataset was also quite poor, as almost all of the wines in the dataset had qualities of 5-7. It would have been interesting if the dataset had contained more data on very high and very low quality wines.